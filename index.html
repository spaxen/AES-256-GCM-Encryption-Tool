<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AES-256-GCM Encryption Tool</title>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      max-width: 1000px;
      margin: 32px auto;
      padding: 16px;
      background: #f6f7f9;
      color: #111;
    }

    h1 { margin-bottom: 6px; font-size: 26px; }

    .subtitle {
      font-size: 13px;
      color: #444;
      margin-bottom: 16px;
    }

    .card {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 16px;
      margin-bottom: 4px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-family: monospace;
      font-size: 14px;
    }

    #plaintext, #ciphertext {
      min-height: 150px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .col {
      flex: 1;
      min-width: 320px;
    }

    button {
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #f2f2f2;
    }

    button.primary {
      background: #111;
      color: #fff;
      border-color: #111;
    }

    .mini {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
    }

    .iv-highlight {
      background: #fff3c4;
      padding: 2px 2px;
      border-radius: 3px;
    }

    .msg { color: #0a7a2f; margin-top: 10px; font-weight: 600; }
    .error { color: #a00; margin-top: 10px; font-weight: 600; display: none; }

    .footer {
      margin-top: 28px;
      font-size: 12px;
      text-align: center;
      color: #666;
    }

    /* -----------------------------------
       MOBILE OPTIMIZATION
    ----------------------------------- */
    @media (max-width: 600px) {
      body {
        margin: 8px;
        padding: 8px;
      }

      .card {
        padding: 16px;
      }

      .col {
        min-width: 100%;
      }

      button {
        width: 100%;
      }

      #plaintext, #ciphertext {
        min-height: 180px;
        font-size: 15px;
      }

      input[type="text"] {
        font-size: 15px;
      }

      .row {
        gap: 8px;
      }
    }
  </style>
</head>

<body>

<h1>AES-256-GCM Encryption Tool</h1>
<div class="subtitle">Client-side authenticated encryption. No data leaves your browser.</div>
<br>

<div class="card">

  <!-- KEY -->
  <div class="row">
    <div class="col">
      <label>Key (HEX – 64 characters / 32 bytes)</label>
      <input id="keyhex" type="text" placeholder="64 hex characters">

      <div class="row">
        <button id="genKey">Generate Key</button>
        <button id="copyKey">Copy Key</button>
      </div>
      <div class="mini">AES-256 requires exactly 64 hex characters.</div>
    </div>

    <!-- IV -->
    <div class="col">
      <label>IV (HEX – 24 characters / 12 bytes)</label>
      <input id="ivhex" type="text" placeholder="24 hex characters">

      <div class="row">
        <button id="genIv">Generate IV</button>
        <button id="copyIv">Copy IV</button>
      </div>
      <div class="mini">Do not reuse an IV with the same key.</div>
    </div>
  </div>

  <!-- PLAINTEXT -->
  <label>Plaintext</label>
  <div id="plaintext" contenteditable="true"></div>

  <div class="row">
    <button id="encryptBtn" class="primary">Encrypt (AES-GCM)</button>
    <button id="copyCombined">Copy Combined (IV|Ciphertext)</button>
  </div>

  <!-- CIPHERTEXT -->
  <label>Ciphertext (Base64)</label>
  <div class="mini">Highlighted text = IV</div>
  <br>
  <div id="ciphertext" contenteditable="true"></div>

  <div class="row">
    <button id="pasteCombined">Paste Combined (IV|Ciphertext)</button>
    <button id="decryptBtn">Decrypt (AES-GCM)</button>
  </div>

  <div class="row">
    <button id="clearBtn">Clear Plaintext</button>
    <button id="clearAllBtn">Clear All</button>
  </div>

  <div id="message" class="msg"></div>
  <div id="error" class="error"></div>

</div>

<div class="footer">Created by Spaxen Karlsson.</div>

<script>
const $ = id => document.getElementById(id);

function err(t){ $("error").style.display="block"; $("error").textContent=t; }
function msg(t){ $("error").style.display="none"; $("message").textContent=t; }

function hexToBytes(hex) {
  hex = hex.replace(/\s+/g, "");
  if (!/^[0-9a-fA-F]*$/.test(hex)) throw Error("HEX contains invalid characters");
  if (hex.length % 2 !== 0) throw Error("Invalid HEX length");
  return Uint8Array.from(hex.match(/.{2}/g).map(b => parseInt(b,16)));
}

function bytesToHex(bytes) {
  return [...bytes].map(b => b.toString(16).padStart(2,"0")).join("");
}

function bytesToBase64(buf) {
  return btoa(String.fromCharCode(...new Uint8Array(buf)));
}

function base64ToBytes(b64) {
  return Uint8Array.from(atob(b64.trim()), c => c.charCodeAt(0));
}

async function importKey(hex) {
  const raw = hexToBytes(hex);
  if (raw.length !== 32) throw Error("Key must be 32 bytes");
  return crypto.subtle.importKey("raw", raw, "AES-GCM", false, ["encrypt","decrypt"]);
}

async function encrypt(pt, keyHex, ivHex) {
  const key = await importKey(keyHex);
  const iv = hexToBytes(ivHex);
  if (iv.length !== 12) throw Error("IV must be 12 bytes");
  const data = new TextEncoder().encode(pt);
  const enc = await crypto.subtle.encrypt({name:"AES-GCM",iv,tagLength:128}, key, data);
  return bytesToBase64(enc);
}

async function decrypt(ct, keyHex, ivHex) {
  const key = await importKey(keyHex);
  const iv = hexToBytes(ivHex);
  const data = base64ToBytes(ct);
  const dec = await crypto.subtle.decrypt({name:"AES-GCM",iv,tagLength:128}, key, data);
  return new TextDecoder().decode(dec);
}

function highlightIV(iv, combined) {
  const [ivPart, ctPart] = combined.split("|");
  return `<span class="iv-highlight">${ivPart}</span>|${ctPart}`;
}

function cleanCiphertextBox() {
  return $("ciphertext").textContent.trim();
}

function generateNewIv() {
  const n = crypto.getRandomValues(new Uint8Array(12));
  const hex = bytesToHex(n);
  $("ivhex").value = hex;
  return hex;
}

/* BUTTONS */

$("genKey").onclick = () => {
  const key = crypto.getRandomValues(new Uint8Array(32));
  $("keyhex").value = bytesToHex(key);
  msg("New AES-256 key generated");
};

$("genIv").onclick = () => {
  generateNewIv();
  msg("New IV generated");
};

$("copyKey").onclick = () => {
  navigator.clipboard.writeText($("keyhex").value);
  msg("Key copied");
};

$("copyIv").onclick = () => {
  navigator.clipboard.writeText($("ivhex").value);
  msg("IV copied");
};

$("copyCombined").onclick = () => {
  const iv = $("ivhex").value.trim();
  const ct = cleanCiphertextBox();

  if (ct.includes("|")) {
    navigator.clipboard.writeText(ct);
  } else {
    navigator.clipboard.writeText(iv + "|" + ct);
  }

  msg("Combined copied");
};

$("pasteCombined").onclick = async () => {
  try {
    const txt = await navigator.clipboard.readText();
    if (!txt.includes("|")) throw Error("Format must be IV|Ciphertext");
    const [iv, ct] = txt.split("|");
    $("ivhex").value = iv;
    $("ciphertext").innerHTML = highlightIV(iv, txt);
    msg("Combined pasted");
  } catch(e){ err(e.message); }
};

/* ENCRYPT */
$("encryptBtn").onclick = async () => {
  try {
    const pt = $("plaintext").textContent.trim();
    const key = $("keyhex").value.trim();
    const iv = $("ivhex").value.trim();

    const ct = await encrypt(pt, key, iv);
    const combined = iv + "|" + ct;
    $("ciphertext").innerHTML = highlightIV(iv, combined);

    msg("Encryption successful");

    generateNewIv(); // new IV for next message
  } catch(e){ err(e.message); }
};

/* DECRYPT */
$("decryptBtn").onclick = async () => {
  try {
    const raw = cleanCiphertextBox();
    let iv, ct;

    if (raw.includes("|")) {
      const parts = raw.split("|");
      iv = parts[0].trim();
      ct = parts[1].trim();
      $("ivhex").value = iv;
    } else {
      iv = $("ivhex").value.trim();
      if (!iv) throw Error("No IV provided");
      ct = raw;
    }

    const pt = await decrypt(ct, $("keyhex").value.trim(), iv);
    $("plaintext").textContent = pt;

    msg("Decryption successful");

    generateNewIv(); // renewal after decrypt
  } catch(e){ err("Decryption failed: " + e.message); }
};

/* CLEAR */
$("clearBtn").onclick = () => {
  $("plaintext").textContent = "";
  generateNewIv();
  msg("");
};

$("clearAllBtn").onclick = () => {
  $("plaintext").textContent = "";
  $("ciphertext").textContent = "";
  $("keyhex").value = "";
  $("ivhex").value = "";
  generateNewIv();
  msg("");
  $("error").style.display="none";
};
</script>

</body>
</html>
